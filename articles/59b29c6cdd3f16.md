---
title: "æœˆåˆŠã€ŒRustã¯ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä½¿ã£ã¦ã‚‚unsafeã ã‚‰ã‘ã«ãªã‚‹ã‹ã‚‰æ„å‘³ãŒãªã„ã€å»ƒåˆŠã®ãŠçŸ¥ã‚‰ã›"
emoji: "ðŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Rust", "embedded"]
published: true
---

çµ„è¾¼ã¿Rustã‚„è‡ªä½œOSãªã©ã«ãŠã„ã¦ã€å¾“æ¥è¨€èªžã‚ˆã‚Šé«˜ã„å®‰å…¨æ€§ãŒã‚ã‚‹ã¨ã•ã‚Œã¦ã„ã‚‹Rustã¯æ³¨ç›®ã•ã‚Œã‚‹ä¸€æ–¹ã€Rustã§ã‚‚ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é‡Žã§é »ç™ºã™ã‚‹ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã‚„ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ãªã©ã§unsafeãƒ–ãƒ­ãƒƒã‚¯ãŒå­˜åœ¨ãŒå¤šããªã‚ŠãŒã¡ã§ã™ã€‚
ã“ã®unsafeãƒ–ãƒ­ãƒƒã‚¯ãŒå¤šããªã‚‹ã®ã§ã€çµå±€Rustã§ã“ã®ã‚ˆã†ãªä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é‡Žã‚’è§¦ã£ã¦ã‚‚æ„å‘³ãŒãªã„ã®ã§ã¯ï¼Ÿå®‰å…¨ã§ã¯ãªã„ã®ã§ã¯ï¼Ÿã¨ã„ã†ç–‘å•ãŒæŠ•ã’ã‹ã‘ã‚‰ã‚Œã‚‹ã“ã¨ãŒã—ã°ã—ã°ã‚ã‚Šã¾ã™ã€‚

ç­†è€…ã¯Twitterã‚„éŽåŽ»ã®ãƒ–ãƒ­ã‚°ã§ã€çµ„è¾¼ã¿Rustã«ãŠã„ã¦ã®unsafeã¨ã®ä»˜ãåˆã„æ–¹ã«ã¤ã„ã¦è§¦ã‚Œã¦ã„ãã¾ã—ãŸãŒã€å†…å®¹ã¨ã—ã¦ã¯åˆ†æ•£ã—ã¦ã„ãŸã®ã§ä»Šä¸€åº¦ã“ã®ç–‘å•ã«å¯¾ã™ã‚‹ã‚¢ãƒ³ã‚µãƒ¼ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã—ã€ã“ã®è«–äº‰ã«çµ‚æ­¢ç¬¦ã‚’æ‰“ã¨ã†ã¨æ€ã„ã¾ã™ã€‚

## Rustã«ãŠã‘ã‚‹unsafeã¨ã¯
ãã‚‚ãã‚‚unsafeã¨ã¯ä½•ã‹ã¨ã„ã†ã®ã¯The Rust Programming Languageã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚è©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html

RustãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¿è¨¼ã™ã‚‹ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã¯åŽ³ã—ãã€æœ¬æ¥ãƒ¡ãƒ¢ãƒªå®‰å…¨ã§ã‚ã‚‹ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒãã®ã¾ã¾æ›¸ã‘ãªã„ã¨ã„ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§é »ç¹ã«ç™»å ´ã™ã‚‹ç›´æŽ¥ã®ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã‚„ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒãã®ä¸­èº«ã‚’ç²¾æŸ»ã™ã‚‹ã“ã¨ã¯é›£ã—ã„ã§ã™ã€‚
ãã®ãŸã‚ã€æŠœã‘é“ã¨ã—ã¦unsafeãƒ–ãƒ­ãƒƒã‚¯ã¨ã„ã†ã‚‚ã®ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ã“ã®ä¸­ã§ã¯unsafeã¨ãƒžãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹æ“ä½œãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ãƒã‚§ãƒƒã‚¯ãŒãªããªã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
å…·ä½“çš„ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚‚ã®ã¨ã—ã¦ã¯

- ç”Ÿãƒã‚¤ãƒ³ã‚¿ã®å‚ç…§å¤–ã—
- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®å¤‰æ›´
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã®å‘¼ã³å‡ºã—
- Cè¨€èªžãªã©ã§æ›¸ã‹ã‚ŒãŸå¤–éƒ¨é–¢æ•°ã®å‘¼ã³å‡ºã—ï¼ˆFFIã®ä½¿ç”¨ï¼‰
- unsafeé–¢æ•°ã®å‘¼ã³å‡ºã—

ãªã©ãŒã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ã€ä¾‹ãˆã°mutableãªå‚ç…§ã‚’è¤‡æ•°ã¤ãã£ãŸã‚Šãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚’ç„¡è¦–ã—ãŸã‚Šã¨ã„ã£ãŸã€ã‚‚ã¨ã‚‚ã¨ã®Rustã®å®‰å…¨æ€§ã®ãŸã‚ã®ãƒ«ãƒ¼ãƒ«ã‚’ç ´ã‚‹ã“ã¨ã¯ç›´æŽ¥ã¯ã§ãã¾ã›ã‚“ï¼ˆä¸€åº¦ç”Ÿãƒã‚¤ãƒ³ã‚¿ã‚’ã¤ãã‚‹ãªã©ã§å®Ÿè³ªçš„ã«åŒã˜ã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ï¼‰ã€‚

ã“ã®ã‚ˆã†ãªunsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’å«ã‚“ã é–¢æ•°ã¯å¿…ãšã—ã‚‚unsafeãªé–¢æ•°ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚äººé–“ãŒã“ã‚Œã¯å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã ã¨åˆ¤æ–­ã§ãã‚‹ã®ã§ã‚ã‚Œã°unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã‚’safeãªé–¢æ•°ã¨ã—ã¦å…¬é–‹ã§ãã¦ã—ã¾ã„ã¾ã™ã€‚
ãŸã ã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå®‰å…¨æ€§ã‚’ä¿è¨¼ã§ããªã„ãŸã‚ã€ã“ã®ã‚ˆã†ãªunsafeãªæ“ä½œã‚’æŒŸã‚“ã§ã‚‚æœ€çµ‚çš„ã«RustãŒæœ¬æ¥ä¿è¨¼ã—ã¦ã„ã‚‹å®‰å…¨æ€§ã‚’ä¿ã£ã¦ã„ã‚‹é–¢æ•°ã®ã¿ã‚’safeãªé–¢æ•°ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã®ãŒæœ›ã¾ã—ã„ã§ã™ã€‚

å®Ÿã¯safeãªæ¨™æº–é–¢æ•°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã‚‹ã¨å®Ÿéš›ã¯å¤šãã®unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚ã‚ˆã£ã¦å®Ÿã¯ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ãªãã¦ã‚‚ã»ã¨ã‚“ã©ã®Rustã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯unsafeãªæ“ä½œã¨å…±å­˜ã—ã¦ã„ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

## unsafeãƒ–ãƒ­ãƒƒã‚¯ã¨ã®å…±å­˜

ã˜ã‚ƒã‚ã€ã»ã¨ã‚“ã©ã®Rustãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒunsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’å«ã‚“ã§ã„ã‚‹ã®ã ã‹ã‚‰ã€RustãŒãƒ¡ãƒ¢ãƒªå®‰å…¨ã¨ã„ã†ã®ã¯å˜˜ãªã®ã‹ã€ã¨ã„ã†ã¨ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ä¾‹ãˆã°stdã«å«ã¾ã‚Œã‚‹`Vec`ã®`insert`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã®å®Ÿè£…ã¯unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’å«ã¿ã¾ã™ã€‚

```rust
    pub fn insert(&mut self, index: usize, element: T) {
        #[cold]
        #[cfg_attr(not(feature = "panic_immediate_abort"), inline(never))]
        #[track_caller]
        #[optimize(size)]
        fn assert_failed(index: usize, len: usize) -> ! {
            panic!("insertion index (is {index}) should be <= len (is {len})");
        }

        let len = self.len();
        if index > len {
            assert_failed(index, len);
        }

        // space for the new element
        if len == self.buf.capacity() {
            self.buf.grow_one();
        }

        unsafe {
            // infallible
            // The spot to put the new value
            {
                let p = self.as_mut_ptr().add(index);
                if index < len {
                    // Shift everything over to make space. (Duplicating the
                    // `index`th element into two consecutive places.)
                    ptr::copy(p, p.add(1), len - index);
                }
                // Write it in, overwriting the first copy of the `index`th
                // element.
                ptr::write(p, element);
            }
            self.set_len(len + 1);
        }
    }
```

å†…éƒ¨ã«æŒã£ã¦ã„ã‚‹ç”Ÿé…åˆ—ã‚’unsafeãƒ–ãƒ­ãƒƒã‚¯å†…ã§æ“ä½œã™ã‚‹ã“ã¨ã§è¦ç´ ã‚’æŒ¿å…¥ã—ã¦ã„ã¾ã™ã€‚ã§ã¯ã€ã“ã®`insert`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯unsafeã‹ã¨è¨€ã‚ã‚Œã‚‹ã¨ãã‚“ãªã“ã¨ã¯ãªã„ã§ã™ã€‚
`insert`ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹é™ã‚Šã¯é…åˆ—ã®æŒ¿å…¥æ“ä½œã«ã‚ˆã£ã¦ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ãŒç ´å£Šã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ãŸã‚ã§ã™ã€‚
C++ã¨ã‹ä»–ã®è¨€èªžã®åŒæ§˜ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®åŒæ§˜ãªæ“ä½œã‚’ã™ã‚‹ã¨ãã«ã€ã“ã“ã«ãƒ¡ãƒ¢ãƒªé–¢é€£ã®ãƒã‚°ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨ã‹æ€¯ãˆãªãŒã‚‰æ›¸ãã¾ã›ã‚“ã‚ˆã­ï¼Ÿ

ã¤ã¾ã‚Šã€unsafeãªãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ã£ã¦ã‚‚äººã®æ‰‹ã§ãã¡ã‚“ã¨ãƒ¡ãƒ¢ãƒªã®æ•´åˆæ€§ã‚’ä¿ã¦ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°ã€safeã¨ã—ã¦æ‰±ã£ã¦ãã‚Œã‚’éš è”½ã—ã¦ã—ã¾ã„ãã‚Œã‚’ä½¿ã†ä¸Šä½ã®ã‚³ãƒ¼ãƒ‰ã¯æ°—ã«ã›ãšã«æ›¸ã‘ã°ã‚ˆã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚³ãƒ¼ãƒ‰ã§ã‚‚åŒã˜ã§ã™ã€‚unsafeãªæ“ä½œã‚’ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ç®‡æ‰€ã¨ã„ã†ã®ã‚’é™å®šã—ã¦é©åˆ‡ãªæŠ½è±¡åŒ–ã‚’è¡Œã†ã“ã¨ã§ã€ãã®ä¸Šä½ã®ã‚³ãƒ¼ãƒ‰ã¯å®‰å…¨ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## çµ„è¾¼ã¿Rustã®æŠ½è±¡åŒ–ã®å…·ä½“ä¾‹

ã¨ã¯ã„ã£ã¦ã‚‚ã€ã„ã–é©åˆ‡ã«æŠ½è±¡åŒ–ã›ã‚ˆã¨è¨€ã‚ã‚Œã¦ã‚‚é›£ã—ã„ã§ã™ã€‚ç‰¹ã«Cè¨€èªžã¨ã‹ã§çµŒé¨“ã‚’ç©ã‚“ã§ããŸäººã¯Cè¨€èªžå‰æã§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è€ƒãˆã¦ã—ã¾ã„ãŒã¡ã§ã€ãã‚Œã‚’æ„šç›´ã«Rustã«ç§»æ¤ã—ã¦ã—ã¾ã†ã¨unsafeãƒ–ãƒ­ãƒƒã‚¯ãŒãã“ã‚‰ä¸­ã«ç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚
ã§ã¯ã„ãã¤ã‹è‡ªåˆ†ãŒç¾Žã—ã„ã¨æ€ã£ãŸæŠ½è±¡åŒ–ã®ä¾‹ã‚’ä¸Šã’ã¦ã¿ã¾ã™

### embedded-hal
Rust embeddedãƒãƒ¼ãƒ ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ã„ã‚‹embedded-halã¨ã„ã†ã‚¯ãƒ¬ãƒ¼ãƒˆã¯å„ç¨®çµ„è¾¼ã¿ãƒœãƒ¼ãƒ‰ã®ãƒšãƒªãƒ•ã‚§ãƒ©ãƒ«ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æŠ½è±¡ç”¨ã®ãƒˆãƒ¬ã‚¤ãƒˆã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

https://github.com/rust-embedded/embedded-hal

ãƒšãƒªãƒ•ã‚§ãƒ©ãƒ«ãƒ‰ãƒ©ã‚¤ãƒã«ç›¸å½“ã™ã‚‹ã®ã§MMIOã®ã‚ˆã†ãªãƒ¡ãƒ¢ãƒªã‚’ç›´æŽ¥è§¦ã‚‹æ“ä½œã‚’ãŸãã•ã‚“å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€æœ€çµ‚çš„ã«ã¯ã™ã¹ã¦ãŒsafeãªé–¢æ•°ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã°Raspberrpy Picoã®UARTãƒ‰ãƒ©ã‚¤ãƒã§1ãƒã‚¤ãƒˆã‚’èª­ã¿è¾¼ã‚€å®Ÿè£…ã¯ã“ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://github.com/rp-rs/rp-hal/blob/2fb63064c98edcf688694bc63dc05f57b89a71b2/rp2040-hal/src/uart/reader.rs#L115

UARTãƒ‰ãƒ©ã‚¤ãƒã‚’å®Ÿè£…ã—ãŸã“ã¨ãŒã‚ã‚‹äººã¯ãªã‚“ã¨ãªãä½•ã‚’ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‹è§£ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’è§¦ã£ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã‚‹ç®‡æ‰€å‘ã‘ã«safeãªé–¢æ•°ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯embedded-halã‚’ä½¿ã£ãŸã‚¯ãƒ¬ãƒ¼ãƒˆã§ã¯ã‚ˆãã‚ã‚‹æ‰‹æ³•ãªã®ã§ã™ãŒã€SVDãƒ•ã‚¡ã‚¤ãƒ«ã¨ã„ã†ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒ¬ã‚¸ã‚¹ã‚¿æƒ…å ±ã‚’è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€ãƒ¬ã‚¸ã‚¹ã‚¿å‘¨ã‚Šã®safeãªé–¢æ•°ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

https://github.com/rp-rs/rp2040-pac

MMIOã‚’è§¦ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã“ã†ã¨ã™ã‚‹ã¨ç”Ÿãƒã‚¤ãƒ³ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ãã®éƒ¨åˆ†ã¯ã©ã†ã—ã¦ã‚‚unsafeã¨ã—ã¦ãƒžãƒ¼ã‚¯ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã—ã€MMIOã¨ã—ã¦ãƒžãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹é ˜åŸŸã«ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã‚‹ã®ã§ã‚ã‚Œã°ä»–ã®ãƒ¡ãƒ¢ãƒªã«æ‚ªå½±éŸ¿ã‚’ä¸Žãˆãªã„ã¯ãšãªã®ã§ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ãŒå£Šã‚Œã‚‹ã“ã¨ã¯ãªã„ã§ã™ã€‚
ã“ã®ã‚ˆã†ãªæŠ½è±¡ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€ä¸Šä½ã®ã‚³ãƒ¼ãƒ‰ã¯ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç”Ÿãƒã‚¤ãƒ³ã‚¿ã‚’è§¦ã‚‹ã¨ã„ã£ãŸãƒªã‚¹ã‚¯ãŒãªããªã‚‹ãŸã‚ã€ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§unsafeãªãƒ–ãƒ­ãƒƒã‚¯ã‚’æŽ’é™¤ã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¦ã„ã¾ã™ã€‚

ã•ã‚‰ã«ä¸Šä½ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã‚¤ãƒ¼ã‚µãƒãƒƒãƒˆãƒ‰ãƒ©ã‚¤ãƒã®å®Ÿè£…ã‚’èª­ã‚“ã ã“ã¨ãŒã‚ã‚Šã€ãã“ã®DMAã‹ã‚‰å—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆã‚’èª­ã¿å‡ºã™æ§‹é€ ä½“ã¯è¨­è¨ˆãŒã†ã¾ã„ã¨æ€ã„ã¾ã—ãŸã€‚

https://garasubo.com/hexo/2020/12/20/ether.html

ãƒãƒ¼ãƒªãƒ³ã‚°å—ä¿¡ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®`recv_next`ã§`RxPacket`ã¨ã„ã†æ§‹é€ ä½“ãŒå—ã‘å–ã‚Œã€ã“ã“ã‹ã‚‰DMAã®ãƒãƒƒãƒ•ã‚¡ã®å‚ç…§ã‚’ã‚‚ã‚‰ã†ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ãŒã€DMAå†…ã®ãƒãƒƒãƒ•ã‚¡ã¯ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡ã«ãªã£ã¦ãŠã‚Šèª­ã¿è¾¼ã¿ãŒçµ‚ã‚ã£ãŸã‚‰é–‹æ”¾ã®ãŸã‚ã®å‡¦ç†ã‚’ã—ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã€‚
ã“ã®æ§‹é€ ä½“ã¯`Drop`ãƒˆãƒ¬ã‚¤ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ã¦ã€ã“ã®æ§‹é€ ä½“ãŒã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹ã¨ãã«è‡ªå‹•çš„ã«ãƒãƒƒãƒ•ã‚¡ã‚’é–‹æ”¾ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

### OSã®ä¾‹
Rustã§OSã‚’ã¤ãã‚‹ã¨ã„ã†è«–æ–‡ãŒã„ãã¤ã‹OSã®ãƒˆãƒƒãƒ—ä¼šè­°ã§ç™ºè¡¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚‰ã¯å˜ã«Linuxã®ã‚ˆã†ãªOSã‚’Rustã§å†å®Ÿè£…ã—ã¾ã—ãŸã‚ˆã¨ã„ã†è©±ã§ã¯ãªãã€Rustã®åž‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¸Šæ‰‹ã«ã¤ã‹ã£ã¦ã‚ã’ã‚‹ã“ã¨ã§ä»Šã¾ã§ã«ãªã„OSã®è¨­è¨ˆæ‰‹æ³•ã‚’ææ¡ˆã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚
ç§ãŒç°¡å˜ã«ç´¹ä»‹ã—ãŸã‚‚ã®ã‚’ä»¥å‰ãƒ—ãƒ¬ã‚¼ãƒ³ã—ãŸã®ãŒlogmiã®è¨˜äº‹ã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://logmi.jp/main/technology/324499

ã“ã“ã§ç´¹ä»‹ã—ãŸTheseusã¨ã„ã†OSã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°ã§æ·±å €ã—ã¦ã„ã¾ã™ã€‚

https://garasubo.com/hexo/2021/04/04/theseus.html

## unsafeãƒ–ãƒ­ãƒƒã‚¯ã«çµžã£ãŸãƒã‚°æ¤œå‡ºæ‰‹æ³•
unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’é©åˆ‡ã«æŠ½è±¡åŒ–ã—ã¦ã—ã¾ãˆã°ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å®‰å…¨ã«æ›¸ã‘ã‚‹ã¨ã„ã†è©±ã‚’ã—ã¾ã—ãŸãŒã€ãã‚Œã§ã‚‚unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ã£ã¦ã„ã‚‹ç®‡æ‰€ã¨ã„ã†ã®ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã¯å®‰å…¨æ€§ãŒä¿è¨¼ã§ããªã„éƒ¨åˆ†ã«ãªã‚Šã¾ã™ã€‚
unsafeãªç®‡æ‰€ãŒé™å®šã•ã‚Œã‚‹ã“ã¨ã§ã€ãŸã—ã‹ã«ä»–ã®è¨€èªžã‚ˆã‚Šã¯ãƒ‡ãƒãƒƒã‚°ã®éš›ã®ç›®æ˜ŸãŒã¤ãã‚„ã™ã„ã¨ã„ã†åˆ©ç‚¹ã¯ã‚ã‚Šãã†ã§ã™ã€‚
ã•ã‚‰ã«è¸ã¿è¾¼ã‚“ã§ã“ã®unsafeã‚³ãƒ¼ãƒ‰ã«çµžã£ã¦æ©Ÿæ¢°çš„ã«è§£æžã™ã‚‹ã“ã¨ã§ãƒã‚°ã‚’ç™ºè¦‹ã™ã‚‹ã¨ã„ã†ç ”ç©¶ã‚‚ã‚ã‚Šã¾ã™ã€‚

https://dl.acm.org/doi/10.1145/3477132.3483570

ã“ã®Rudraã¨ã„ã†ç ”ç©¶ã§ã¯unsafeãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”¨ã„ã¦ã„ã‚‹stdã‚’å«ã‚€è‘—åãªã‚¯ãƒ¬ãƒ¼ãƒˆã‚’è§£æžã—ã¦76å€‹ã®CVEã¨112å€‹ã®RustSec Advisoryã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚

## Rustã®é­…åŠ›ã¯å®‰å…¨æ€§ã ã‘ã§ã¯ãªã„
Rustã¯å®‰å…¨æ€§ã°ã‹ã‚ŠãŒæ³¨ç›®ã•ã‚ŒãŒã¡ã«ã§ã™ãŒã€é–¢é€£ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒæ´—ç·´ã•ã‚Œã¦ã„ã‚‹ç‚¹ã‚‚é­…åŠ›ã ã¨ç­†è€…ã¯è€ƒãˆã¦ã„ã¾ã™ã€‚
`cargo`ã«ã‚ˆã‚‹æ¨™æº–ã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã¯Cè¨€èªžã«ã¯ãªã„ã‚‚ã®ã§ã™ã€‚ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚‚æ¨™æº–ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã‚‚é–‹ç™ºä½“é¨“ã‚’å‘ä¸Šã™ã‚‹ã®ã«å½¹ã«ç«‹ã¡ã¾ã™ã€‚
ã¾ãŸã€`core`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚æ„å¤–ã¨å……å®Ÿã—ã¦ã„ã¦ã€`std`ãŒä½¿ãˆãªã„çµ„è¾¼ã¿ç’°å¢ƒã§ã‚‚ååˆ†ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚

ãŸã¨ãˆã‚³ãƒ¼ãƒ‰ãŒunsafeã ã‚‰ã‘ã«ãªã£ãŸã¨ã—ã¦ã‚‚ã€Cè¨€èªžã‚„ä»–ã®è¨€èªžã§ã¯ãã‚‚ãã‚‚ä¿è¨¼ãŒãªã‹ã£ãŸéƒ¨åˆ†ãªã®ã§ã€ä»–ã®è¨€èªžã¨åŒç­‰ã®æ°´æº–ã®å®‰å…¨æ€§ã«ãªã‚‹ã¨ã„ã†ã ã‘ã®è©±ã§ã™ã€‚
å˜ã«ã“ã‚Œã‚‰ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã„ãŸã„ã¨ã„ã†ç†ç”±ã ã‘ã§ã‚‚Rustã‚’ä½¿ã†ä¾¡å€¤ã¯ã‚ã‚‹ã¨ç­†è€…ã¯è€ƒãˆã¾ã™ã€‚

## Rustã¯éŠ€ã®å¼¾ä¸¸ã§ã¯ãªã„
Rustã¯æœ€è¿‘ã«ãªã‚Šäººæ°—ãƒ»çŸ¥ååº¦ã‚‚ä¸ŠãŒã‚Šã€å®Ÿéš›ã«ä½¿ã£ã¦ã„ã‚‹ä¼æ¥­ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚å¢—ãˆã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã§ã€éŽåº¦ãªæœŸå¾…ã‹ã‚‰èª¤è§£ã‚’ç”Ÿã‚€ã“ã¨ã‚‚å¤šã€…ã‚ã‚‹ã®ã‹ãªã¨æ„Ÿã˜ã¾ã™ã€‚
è‡ªåˆ†ã§ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚„ãƒ‡ãƒã‚¤ã‚¹æŠ½è±¡åŒ–ã‚’ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ä½Žãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é‡Žã§RustãŒæä¾›ã™ã‚‹ã®ã¯å®Œå…¨ãªãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã¨ã„ã†ã‚ˆã†ãªå¹»æƒ³ã§ã¯ãªãã€ã‚ãã¾ã§å®‰å…¨æ€§ã‚’æ‹…ä¿ã—ã‚„ã™ã„æ§‹é€ ã‚’ã¤ãã‚‹ãŸã‚ã®ç’°å¢ƒã ã‘ã§ã™ã€‚
ã¾ãŸã€RustãŒä¿è¨¼ã™ã‚‹ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã¯ã™ã¹ã¦ã®ãƒã‚°ã‚’æŽ’é™¤ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã¯Rustã§ã¯safeãªæ“ä½œã¨ã—ã¦è¨±å®¹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ã‚¸ãƒƒã‚¯ã®ãƒŸã‚¹ã‚„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®èª¤ã‚Šã‚‚å½“ç„¶Rustã§ã¯é˜²ã’ã¾ã›ã‚“ã€‚

ã—ã‹ã—ãªãŒã‚‰ã€Rustã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§å¾“æ¥ã§ã¯ä¿è¨¼ãŒé›£ã—ã‹ã£ãŸæ€§è³ªã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¿è¨¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã®ã¯å®‰å…¨æ€§ã‚’é«˜ã‚ã‚‹ä¸Šã§å¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚
ãƒ¢ãƒ€ãƒ³ãªè¨€èªžæ©Ÿèƒ½ã‚’ãƒ•ãƒ«ã«æ´»ç”¨ã—ã¦ä»Šã¾ã§ã¯ã§ããªã‹ã£ãŸæŠ½è±¡åŒ–ã‚’è¡Œã†ã“ã¨ã§ã€ã‚ˆã‚Šå®‰å…¨ã‹ã¤åŠ¹çŽ‡çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãå¯èƒ½æ€§ã‚’åˆ‡ã‚Šé–‹ã„ã¦ãã‚Œã¾ã™ã€‚
çµ„è¾¼ã¿Rustã¯ã¾ã ã¾ã ç™ºå±•é€”ä¸Šã®åˆ†é‡Žãªã®ã§ã€ã¿ãªã•ã‚“ã‚‚ã“ã®å¯èƒ½æ€§ã‚’æŽ¢æ±‚ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
