---
title: "私流コードコメントライティング"
emoji: "🦔"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["document"]
published: true
---

2024-05-25 前提についてなどちょこっと加筆

コードを書いているときに書くコメントについて自分が普段心がけていることについて書いていきます。
記事のタイトルの通りあくまで自分がこう書いたほうがいいと思っていることなので、そのチームによってありがたいと思うコメントは異なるかもしれないが、参考になればというのとこれらの書き方へのフィードバックをもらえる機会になればと思っているので、思うところがあればコメントを残してもらえると幸いです。

今回対象とするのは、Doxygenやpydocのような特殊なコメントによりドキュメントを生成するツール向けのものではなく、普通のコードコメントについてです。
また、対象としているのは複数人開発でかつ、GitHub等のコード共有プラットフォームでコードレビューを行うような環境でのコードコメントについてです。
普通のコードコメントはコードの読み手に対してコードの意図を伝えたり実装の方針を伝えることにより、コードの意味理解を助けてコードの保守や変更を容易にするために書かれているものです。
一方でコードコメントもコードと同じくらい資産として残り続けるものなので、適切に書かれていないとコードの理解を妨げることになります。

このことを踏まえて具体的にどのような点に気をつけてコメントを書いているかを示していきます。

## Copilotにコード生成を促すように書く

GitHub Copilotのようなコード生成支援ツールはコードのコメントを読み込んでコードを生成することができます。
このようなコメントでコード生成に成功する場合、コードとコメントの整合性が取れている可能性が高いため生成に成功した場合はそのままコードの理解を助けるコメントとして機能します。
もっともCopilotの生成機能は未だ発展途上であるため、生成されたコードが正しくないケースも多いので信頼できないので頼り切りにはしないようにする必要はありますがそれは別の話です。

個人的にはCopilotの生成機能に頼りたくなるタイミングというのはコードのコメントを書くといい感じになるタイミングと一致しているように思うので基準としてはいいのではないかと思っています。
このようなコメントを書くことは仮にそのツールを使わない場合でも、自分のコードを書くときの指針を整理することになりコードを書きながら「あれ？今ってどういうコードを書いているんだっけ？」みたいな事態になることを防ぐことにもなります。

## TODOコメントは具体的に何をすべきかを書く

長い間開発されているプロジェクトでコードがTODOまみれになっていて、しかもその意図が理解しにくいというのはよく見る光景ではないでしょうか。
コードに問題があることは認識しつつも、一旦はそのままにしておくというのは製品開発においてまっとうな判断ですが、そのTODOコメントの意図がわからなければ消すべきなのか・このコードは再利用可能なのかといった判断が難しくなります。
そのためTODOコメントは具体的に何をそのコードの抱える問題について書かなければなりません。

以下は具体的に何をすべきかわかりにくいTODOコメントの例です

- 複雑なのでリファクタリングする
    - どうリファクタリングするかが不明確。やっていることが複雑ならコードも当然複雑になるので、複雑なのはしょうがないことかもしれない
    - どうリファクタリングするかのアイデアがあるのであればそれを書くべき、ないのであればそもそも必然的に複雑になっているのかもしれないのでコメントは書かないほうがいいでしょう
- あっているか自信がない
    - ではどうやったら自信を持てるのかがわからずそのままになってしまう
    - そもそも自信がないのであればその場でテストを書いたりして自信を持ったコードにした上でメインラインに取り込むべき


## 主観的な意見や抽象的な指示語は避ける

コードコメントは他人のために書くのであるため、自分にしかわからない恐れがある主観的な意見や抽象的な指示語は避けるべきです。
以下のようなコメントは避けるべきです。

- 気持ち悪いコードだけど仕方ない
    - 気持ち悪いというのはあなたの感想ですよね？
    - 気持ち悪いという感想を共有したところで読み手のアクションは変わりますか？
    - 「なぜ気持ち悪いと思ったのか」「気持ち悪いからどうしたいのか」という点を具体化すればコメントとして意味があるかもしれません
- いろいろあってこうなった
    - いろいろとは？例えば新しく入った新人が読んでもわからない
    - その経緯が重要でコメントに書くには長すぎるというのであれば別ドキュメント等にして書き残してそこへのリンクを提供しましょう

## まとめ

コードのコメントは他人のコード理解を助ける重要なものであります。一方で、コメントが不適切だとむしろコードの読み手の認知負荷が増えてしまいます。
そのため、自分の場合は書くべきポイントは絞ってメリハリのあるコメントを心がけています。
繰り返しになりますが、これはあくまで自分がこうしたほうがいいと思っているものであり違う考え方もあるかもしれません。
もし、この記事に対してフィードバックがあればコメントを残してもらえると幸いです。
